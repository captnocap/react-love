=== METADATA ===
title: useLoveRPC
description: Call Lua RPC methods and await results from the React side.
category: Hooks
platforms: love2d, web, terminal, cc, nvim, hs, awesome
keywords: useLoveRPC, hook, rpc, remote procedure call, async, await, promise, bridge, lua
related: uselove.txt, uselovesend.txt
difficulty: intermediate

=== OVERVIEW ===
useLoveRPC provides a way to call Lua-side RPC (Remote Procedure Call) methods from React
and await the results. Unlike the event-based hooks (useLove, useLoveEvent), this hook
supports request-response patterns where you need a return value from the Lua runtime.

The hook returns a memoized async function. When called, it sends the RPC request via the
bridge, waits for the response, and resolves the promise with the result. An optional
timeout prevents hanging on unresponsive calls.

=== API / SYNTAX ===
Signature:
  function useLoveRPC<T = any>(method: string): (args?: any, timeoutMs?: number) => Promise<T>

Type parameter:
  T    The expected return type of the RPC call. Defaults to any.

Parameters:
  method: string
    The name of the Lua-side RPC method to call. Must be registered on the Lua side.

Returns:
  (args?: any, timeoutMs?: number) => Promise<T>

  An async function that:
    args?: any         Optional arguments passed to the Lua method.
    timeoutMs?: number Optional timeout in milliseconds. If the Lua side does not respond
                       within this window, the promise rejects.

  Resolves with the return value from the Lua method (typed as T).

=== EXAMPLES ===
Example 1: Query nearby entities
---
import { useState, useEffect } from 'react';
import { useLoveRPC } from '@ilovereact/core';

interface Entity {
  id: number;
  type: string;
  x: number;
  y: number;
}

function NearbyList() {
  const getNearby = useLoveRPC<Entity[]>('getNearby');
  const [entities, setEntities] = useState<Entity[]>([]);

  useEffect(() => {
    const fetch = async () => {
      const nearby = await getNearby({ x: 100, y: 200, range: 500 });
      setEntities(nearby);
    };
    fetch();
  }, [getNearby]);

  return (
    <Box style={{ width: '100%', height: '100%', padding: 16 }}>
      {entities.map((e) => (
        <Text key={e.id} style={{ fontSize: 12, color: '#cdd6f4' }}>
          {`${e.type} at (${e.x}, ${e.y})`}
        </Text>
      ))}
    </Box>
  );
}
---
Platforms: All

Example 2: RPC with timeout
---
import { useLoveRPC } from '@ilovereact/core';

function SaveButton() {
  const saveGame = useLoveRPC<boolean>('saveGame');

  const handleSave = async () => {
    try {
      const success = await saveGame({ slot: 1 }, 5000); // 5 second timeout
      console.log(success ? 'Saved!' : 'Save failed');
    } catch (err) {
      console.error('Save timed out or failed:', err);
    }
  };

  return (
    <Box style={{ width: 120, height: 40, backgroundColor: '#a6e3a1', borderRadius: 8 }}
         onClick={handleSave}>
      <Text style={{ fontSize: 16, color: '#1e1e2e' }}>Save</Text>
    </Box>
  );
}
---
Platforms: All

=== PLATFORM NOTES ===
The RPC mechanism uses the bridge's rpc() method, which is implemented differently per
target:
- Love2D: RPC call is dispatched via QuickJS FFI. The Lua side processes the call and sends
  the response back through the bridge.
- Web: RPC is processed via the in-memory bridge queue.
- Grid targets: RPC travels over IPC/WebSocket.

The Lua-side RPC method must be registered to handle the call. Calling an unregistered
method will result in an error or timeout.

=== CRITICAL RULES ===
- The returned function is memoized (stable reference) -- safe to include in dependency arrays
- Always handle promise rejections (timeouts, errors from Lua side)
- The RPC method name must match a registered handler on the Lua side
- RPC is async -- do not use it in render functions, use it in effects or event handlers
- Must be used inside a BridgeProvider context
- Large payloads may impact performance due to serialization overhead

=== SEE ALSO ===
- uselove.txt -- Event-based communication (no request-response)
- uselovesend.txt -- Fire-and-forget commands (no response)
- useLoveState -- Shared state (auto-sync, no manual RPC)
